======= waves =======

waves is a bank of wavetable oscillators with modulation. each oscillator is passed through a state variable filter.

==== architecture ====

=== oscillators: ===

each oscillator has FM modulation and waveshape-modulation. modulation feedback is supported through a 1-sample delay. // note: will add more arbitrary delay / echo shortly. //

FM modulation is implemented as phase modulation; this has some advantages such as compensating for the perceived offset in center pitch.

wavetables are stored sequentially in memory, and the "wave" parameter interpolates between adjacent tables. currently the contents of the wavetables are fixed, but in the future we should support loading arbitrary table data from sdcard.

the current contents are, in this order: 
sine, triangle, saw, "more saw."

all are bandlimited to 11 harmonics or less, and higher harmonics are added consistently as the waveshape parameter is increased


the "bl" parameter controls a very simple and ad-hoc bandlimiting algorithm. when bl=1, the shape parameter (after modulation) is fully restricted by the current frequency (also after modulation); so, with bl=1 the shape will approach a sinewave as the frequency approaches maximum. this helps reduce aliasing artifacts. with bl=0, no limitation is performed and heavy aliasing is allowed to occur.

note that FM and shape modulation can still produce aliasing; the frequency components generated by these processes are much harder to control. // note: this is especially true with the current implementation of shape modulation; it effectively rectifies the mod signal. fixing this shortly. //

=== smoothing: ===

all oscillator parameters are subjected to smoothing by simple lowpass filters, with the smoothing parameter given in seconds. this means that new parameter values will be approached with an exponential curve, and converge within -120dB of the target value in the given amount of time. (at which point the smoothing algorithm will set the target to the exact specified value.)

smoothing on audio-modulated parameters always occurs before modulation is applied.

// note: we will add smoothing to filter parameters shortly.//

=== filters: ===

each state variable filter simultaneously produces lowpass, highpass, bandpass, and notch outputs, which can be asrbitraily mixed.


=== routing: ===

// note: this will change shortly as we add more panning parameters.//

<code>
oscN --> svfN  * wetN --+--> * ampN --> all outputs
    |                   ^
    V                   |
    --------> * dryN ----


inN ---> * ioN ---> outN
</code>

==== parameters ====

- "hzN :\\
oscillator N, base frequency \\ 
parameter type: Note \\ 
range: [~8 Hz, ~16000 Hz] \\ 

- "tuneN" :\\
oscillator 1, tuning ratio  \\ 
actual base frequency is hz * tune \\ 
parameter type: Fixed \\ 
range: [0.25, 4.0]

- "ampN" :\\
oscillator N, amplitude (post-filter) \\ 
parameter type: Amp \\ 
range: [0, 1.0] (bees will display dB) \\ 

- "pmXY" :\\
phase-modulation amount from oscX -> oscY \\ 
parameter type: Fixed \\ 
range: [0, 1] \\ 

- "wmXY" :\\
waveshape-modulation amount from oscX -> oscY \\ 
parameter type: Fixed \\ 
range: [0, 1]

- "waveN" :\\
base waveshape for oscillator N \\ 
parameter type: Fixed \\ 
range: [0, 1]

- "bl1" :\\
bandlimiting coefficient for oscillator N \\ 
parameter type: Fixed \\ 
range: [0, 1]

- "cutN" :\\
filter cutoff frequency for filter N \\ 
parameter type: SvfFreq \\ 
range: [ ~8hz, ~16000hz ]

- "rqN" :\\
reciprocal of Q for filter N \\ 
zero equals full resonance \\ 
parameter type: Fixed \\ 
range: [0, 2]

- "lowN" :\\
lowpass output amplitude for filter N \\ 
parameter type: Amp \\ 
range: [0, 1.0] (bees will display dB

- "highN" :\\
highpass output amplitude for filter N \\ 
parameter type: Amp \\ 
range: [0, 1.0] (bees will display dB

- "bandN" :\\
bandpass output amplitude for filter N \\ 
parameter type: Amp \\ 
range: [0, 1.0] (bees will display dB

- "notchN" :\\
notch output amplitude for filter N \\ 
parameter type: Amp \\ 
range: [0, 1.0] (bees will display dB

- "fwetN" :\\
volume of filtered signal from filter N \\ 
parameter type: Amp \\ 
range: [0, 1.0] (bees will display dB

- "fdryN" :\\
volume of dry signal from filter 1 \\ 
parameter type: Amp \\ 
range: [0, 1.0] (bees will display dB

- "hzNSlew" :\\
- "pmXYSlew" :\\
- "wmXYSlew" :\\
- "waveNSlew" :\\
- "ampNSlew" :\\

slew times for corresponding parameters \\ 
parameter type: Integrator \\ 
range: [0, 32] in seconds

- "ioAmp1" :\\
- "ioAmp2" :\\
- "ioAmp3" :\\
- "ioAmp4" :\\

pass-through amplitude for each input/output pair \\ 
parameter type: Amp \\ 
range: [0, 1] (bees displays decibels) \\ 
	  
- "dac0" :\\
- "dac1" :\\
- "dac2" :\\
- "dac3" :\\

CV output value for each channel \\ 
parameter type: Fixed \\ 
range: [0, 1] \\ 

- "dacSlew0" :\\
- "dacSlew1" :\\
- "dacSlew2" :\\
- "dacSlew3" :\\

slew times for CV output \\ 
parameter type: Integrator \\ 
range: [0, 32] in seconds \\ 


==== in use ====
general info on using waves in a bees matrix:\\

- linear frequency control can be achieved by multiplying MIDI notes *256 and attaching to frequency control input.
